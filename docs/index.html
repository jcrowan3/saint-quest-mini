<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Saint Quest</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-dark: #1a0a2e;
      --secondary-dark: #2d1b4d;
      --accent-gold: #d4af37;
      --accent-blue: #4a90e2;
      --accent-purple: #9c27b0;
      --text-light: #f0f0f0;
      --text-dark: #121212;
      --card-bg: rgba(255, 255, 255, 0.1);
      --border-radius: 12px;
      --transition: all 0.4s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Lato', sans-serif;
      background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
      color: var(--text-light);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeIn 1s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    h1, h2, h3 {
      font-family: 'Cinzel', serif;
      color: var(--accent-gold);
      text-align: center;
    }

    .container {
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
    }

    .screen {
      display: none;
      animation: slideIn 0.5s ease-out;
      background: var(--card-bg);
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }

    .screen.active {
      display: block;
    }

    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .story-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 25px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: var(--transition);
    }

    .story-card:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-5px);
    }

    .virtue-badge {
      display: inline-block;
      padding: 6px 12px;
      margin: 5px;
      border-radius: 50px;
      font-size: 0.9em;
      font-weight: bold;
      transition: var(--transition);
    }

    .v-faith { background-color: #2196F3; color: white; }
    .v-mercy { background-color: #4CAF50; color: white; }
    .v-courage { background-color: #F44336; color: white; }
    .v-wisdom { background-color: #9C27B0; color: white; }

    .progress-container {
      margin: 20px 0;
    }

    .progress-bar {
      height: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      overflow: hidden;
    }

    .progress {
      height: 100%;
      background: var(--accent-gold);
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    .btn {
      padding: 12px 24px;
      margin: 10px 5px;
      border: none;
      border-radius: var(--border-radius);
      background: var(--accent-gold);
      color: var(--text-dark);
      font-family: 'Cinzel', serif;
      font-size: 1.1em;
      cursor: pointer;
      transition: var(--transition);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: bold;
    }

    .btn:hover {
      background: #f5d64a;
      transform: scale(1.05);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-secondary {
      background: transparent;
      border: 2px solid var(--accent-gold);
      color: var(--accent-gold);
    }

    .btn-secondary:hover {
      background: rgba(212, 175, 55, 0.2);
    }

    .columns {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .column {
      flex: 1;
      min-width: 200px;
    }

    .saint-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
      cursor: pointer;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .saint-card:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-5px);
    }

    .saint-card h3 {
      margin: 10px 0;
    }

    .avatar {
      font-size: 3em;
      margin: 10px 0;
    }

    .footer {
      margin-top: 30px;
      text-align: center;
      font-size: 0.9em;
      color: rgba(255, 255, 255, 0.6);
    }

    /* Difficulty selector */
    .difficulty-selector {
      text-align: center;
      margin: 20px 0;
    }
    .difficulty-selector h3 {
      margin-bottom: 12px;
    }
    .diff-btn {
      padding: 10px 20px;
      margin: 5px;
      border: 2px solid var(--accent-gold);
      border-radius: 8px;
      background: transparent;
      color: var(--accent-gold);
      font-family: 'Cinzel', serif;
      font-size: 0.95em;
      cursor: pointer;
      transition: var(--transition);
    }
    .diff-btn:hover, .diff-btn.active {
      background: var(--accent-gold);
      color: var(--text-dark);
    }
    .timer-bar {
      height: 4px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      margin: 10px 0;
      overflow: hidden;
      display: none;
    }
    .timer-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
      border-radius: 2px;
      transition: width 0.1s linear;
      width: 100%;
    }
    .hint-text {
      color: #fbbf24;
      font-style: italic;
      margin-top: 8px;
      font-size: 0.9em;
      display: none;
    }

    /* Particles */
    .particle {
      position: fixed;
      pointer-events: none;
      font-size: 16px;
      z-index: 999;
      animation: particleFade 1s ease-out forwards;
    }
    @keyframes particleFade {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-80px) scale(0.5); }
    }

    /* Screen shake */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-5px); }
      80% { transform: translateX(5px); }
    }
    .shake {
      animation: shake 0.4s ease-in-out;
    }

    /* Radar chart */
    .radar-container {
      text-align: center;
      margin: 20px 0;
    }
    .radar-container canvas {
      max-width: 300px;
      max-height: 300px;
    }

    .balloons {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
    }

    .balloon {
      position: absolute;
      font-size: 24px;
      animation: float 10s linear infinite;
    }

    @keyframes float {
      0% {
        transform: translateY(100vh) rotate(0deg);
      }
      100% {
        transform: translateY(-100px) rotate(360deg);
      }
    }

    .question-container {
      margin: 20px 0;
    }

    .radio-group {
      margin: 15px 0;
    }

    .radio-option {
      display: block;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: var(--transition);
    }

    .radio-option:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .radio-option input {
      margin-right: 10px;
    }

    .result {
      padding: 15px;
      border-radius: var(--border-radius);
      margin: 15px 0;
      text-align: center;
    }

    .correct {
      background: rgba(76, 175, 80, 0.2);
      border: 1px solid #4CAF50;
    }

    .incorrect {
      background: rgba(244, 67, 54, 0.2);
      border: 1px solid #F44336;
    }

    @media (max-width: 768px) {
      .columns {
        flex-direction: column;
      }

      .avatar {
        font-size: 2em;
      }

      h1 {
        font-size: 2em;
      }

      h2 {
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚öîÔ∏è Saint Quest üõ°Ô∏è</h1>

    <!-- Select Screen -->
    <div id="select-screen" class="screen active">
      <h2>Choose Your Hero</h2>
      <div class="difficulty-selector">
        <h3>‚öîÔ∏è Difficulty</h3>
        <button class="diff-btn active" onclick="setDifficulty('easy',this)">Easy</button>
        <button class="diff-btn" onclick="setDifficulty('normal',this)">Normal</button>
        <button class="diff-btn" onclick="setDifficulty('hard',this)">Hard</button>
      </div>
      <div class="columns" id="saint-grid"></div>
    </div>

    <!-- Play Screen -->
    <div id="play-screen" class="screen">
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress" id="progress-bar"></div>
        </div>
        <p id="progress-text" style="text-align: center;"></p>
      </div>

      <div class="story-card">
        <h2 id="quest-title">Loading...</h2>
        <p id="quest-story" style="font-size: 1.2em; line-height: 1.6;"></p>
      </div>

      <div class="timer-bar" id="timer-bar"><div class="timer-fill" id="timer-fill"></div></div>
      <div class="question-container" id="question-container">
        <!-- Questions rendered here -->
      </div>
      <div class="hint-text" id="hint-text"></div>

      <div class="columns">
        <div class="column">
          <div class="story-card">
            <h3>Profile</h3>
            <div id="profile-content">
              <!-- Profile rendered here -->
            </div>
          </div>
        </div>
      </div>

      <button id="continue-btn" class="btn btn-secondary" style="display: none;" onclick="nextQuest()">Continue</button>
    </div>

    <!-- Done Screen -->
    <div id="done-screen" class="screen">
      <div class="story-card" style="text-align: center; border-color: gold; background-color: #fffef0;">
        <h1>Sainthood Unlocked!</h1>
        <div style="font-size: 80px;">üòá</div>
        <p style="font-size: 1.3em;">You have completed the journey of <span id="saint-name"></span>.</p>
        <p><i>"Start by doing what's necessary; then do what's possible; and suddenly you are doing the impossible."</i></p>
      </div>

      <h3>Final Virtue Profile</h3>
      <div class="radar-container"><canvas id="radar-canvas" width="300" height="300"></canvas></div>
      <div id="final-profile"></div>

      <button class="btn" onclick="resetGame()">Start New Journey</button>
    </div>
  </div>

  <div class="balloons" id="balloons"></div>

  <div class="footer">
    &copy; Saint Quest Game | Faithful to Catholic Virtues
  </div>

  <script>
    // Game Data (embedded)
    const saints = [
      { "id": "francis", "name": "St. Francis of Assisi", "avatar": "üê∫", "virtues": ["Mercy", "Courage"] },
      { "id": "carlo", "name": "St. Carlo Acutis", "avatar": "üíª", "virtues": ["Wisdom", "Faith"] },
      { "id": "joan", "name": "St. Joan of Arc", "avatar": "üó°Ô∏è", "virtues": ["Courage", "Faith"] },
      { "id": "aquinas", "name": "St. Thomas Aquinas", "avatar": "üìö", "virtues": ["Wisdom", "Faith"] },
      { "id": "teresa", "name": "St. Teresa of Calcutta", "avatar": "üïäÔ∏è", "virtues": ["Mercy", "Faith"] },
      { "id": "patrick", "name": "St. Patrick", "avatar": "‚òòÔ∏è", "virtues": ["Courage", "Faith"] },
      { "id": "therese", "name": "St. Th√©r√®se of Lisieux", "avatar": "üåπ", "virtues": ["Faith", "Mercy"] },
      { "id": "frassati", "name": "Bl. Pier Giorgio Frassati", "avatar": "‚õ∞Ô∏è", "virtues": ["Courage", "Mercy"] }
    ];

    const quests = {
      "francis": [
        { "title": "The Wolf of Gubbio", "story": "The town of Gubbio lives in terror. A massive wolf prowls the countryside, attacking livestock and even threatening people who venture beyond the walls. The townspeople beg Francis for help, expecting him to call for hunters ‚Äî but Francis has a different plan.", "challenge": { "type": "dilemma", "prompt": "The wolf snarls at you from the edge of the forest. What do you do?", "options": ["Walk toward it unarmed, speaking words of peace", "Organize the townspeople to drive it away", "Set traps around the village perimeter", "Pray from a safe distance and hope it leaves"], "answer_index": 0 }, "reward": {"Mercy": 2, "Courage": 1} },
        { "title": "Sermon to the Birds", "story": "Walking through the Spoleto Valley, Francis notices a vast flock of birds gathered in the trees and fields. His companions want to press on, but Francis feels called to stop. He begins to preach to the birds about gratitude for God's gifts ‚Äî and remarkably, they fall silent and listen.", "challenge": { "type": "trivia", "question": "What is St. Francis of Assisi the patron saint of?", "choices": ["Animals and ecology", "Lost causes", "Travelers", "Musicians"], "answer_index": 0 }, "reward": {"Mercy": 1, "Courage": 1} },
        { "title": "Rebuild My Church", "story": "Praying before a crucifix in the crumbling chapel of San Damiano, Francis hears a voice: 'Francis, go and repair my church, which as you see is falling into ruin.' He takes it literally at first, hauling stones to rebuild the chapel ‚Äî but gradually understands the deeper call to renew the entire Church.", "challenge": { "type": "dilemma", "prompt": "You feel called to rebuild something broken. What is the best first step?", "options": ["Start with small acts of love and service", "Wait for someone more qualified to lead", "Seek recognition for your willingness", "Debate the best approach endlessly"], "answer_index": 0 }, "reward": {"Courage": 2, "Mercy": 1} },
        { "title": "The Stigmata", "story": "On Mount La Verna in 1224, during an intense period of prayer and fasting, Francis has a vision of a seraph ‚Äî a six-winged angel bearing the image of Christ crucified. When the vision fades, Francis discovers he bears the wounds of Christ on his hands, feet, and side ‚Äî the first recorded stigmata.", "challenge": { "type": "trivia", "question": "In what year did Francis of Assisi receive the stigmata on Mount La Verna?", "choices": ["1224", "1210", "1226", "1209"], "answer_index": 0 }, "reward": {"Faith": 2, "Courage": 1} },
        { "title": "Lady Poverty", "story": "Born to a wealthy cloth merchant, the young Francis loved fine clothes and parties. After a profound conversion, he stripped off his expensive garments in the town square, renouncing his inheritance before the bishop and his own father. He chose radical poverty as his bride ‚Äî 'Lady Poverty' ‚Äî owning nothing so he could receive everything from God.", "challenge": { "type": "trivia", "question": "What was Francis's father's profession before Francis renounced his wealth?", "choices": ["Cloth merchant", "Blacksmith", "Farmer", "Nobleman"], "answer_index": 0 }, "reward": {"Mercy": 1, "Courage": 2} }
      ],
      "carlo": [
        { "title": "The Digital Evangelist", "story": "At just 11 years old, Carlo Acutis began cataloging every known Eucharistic miracle in the world, building a website to share them. While other kids his age were playing video games, Carlo was teaching himself web design and programming to spread the faith ‚Äî making him a pioneer of digital evangelization.", "challenge": { "type": "trivia", "question": "What did Carlo Acutis famously catalog on his website?", "choices": ["Eucharistic miracles", "Lives of the saints", "Marian apparitions", "Biblical archaeology"], "answer_index": 0 }, "reward": {"Faith": 2, "Wisdom": 1} },
        { "title": "Coding for the Kingdom", "story": "Carlo believed technology was a gift from God that should be used to bring people closer to Him. He built websites, edited videos, and created digital content about the faith ‚Äî all while maintaining a deep prayer life. He once said, 'The internet is a gift from God, and we must use it well.'", "challenge": { "type": "dilemma", "prompt": "You have a talent for technology. How do you use it for God?", "options": ["Teach others what you've learned and share the faith", "Keep your skills to yourself", "Use it only to gain followers", "Abandon technology entirely"], "answer_index": 0 }, "reward": {"Wisdom": 2, "Faith": 1} },
        { "title": "Daily Mass", "story": "From the time of his First Communion at age 7, Carlo never missed daily Mass. He called the Eucharist 'my highway to heaven.' Even as a teenager surrounded by secular culture in Milan, he prioritized his time before the Blessed Sacrament above everything else.", "challenge": { "type": "trivia", "question": "Carlo called the Eucharist his '_____ to heaven.'", "choices": ["Highway", "Ladder", "Bridge", "Doorway"], "answer_index": 0 }, "reward": {"Faith": 2, "Wisdom": 1} },
        { "title": "A Heart for the Poor", "story": "Despite coming from a wealthy Italian family, Carlo lived simply and gave generously. He saved his allowance to buy sleeping bags for homeless people in Milan, and he volunteered at a soup kitchen run by the Capuchin friars. His mother later said she never knew how much he gave away until after his death.", "challenge": { "type": "dilemma", "prompt": "You receive a generous allowance. What do you do with it?", "options": ["Save some and give the rest to those in need", "Spend it all on yourself ‚Äî you earned it", "Save every penny for the future", "Give it all away and borrow from friends"], "answer_index": 0 }, "reward": {"Mercy": 2, "Faith": 1} },
        { "title": "Called Home Young", "story": "In October 2006, 15-year-old Carlo was diagnosed with aggressive leukemia. Facing his death with extraordinary faith, he offered his sufferings for the Pope and the Church. He told his mother, 'I offer all the suffering I will have to endure for the Lord, for the Pope, and for the Church.' He died on October 12, 2006, and was beatified in 2020.", "challenge": { "type": "trivia", "question": "At what age did Carlo Acutis die of leukemia?", "choices": ["15", "12", "17", "20"], "answer_index": 0 }, "reward": {"Faith": 2, "Courage": 1} }
      ],
      "joan": [
        { "title": "Voices from Heaven", "story": "In the small village of Domr√©my, 13-year-old Jeanne hears voices in her father's garden. Saints Michael, Catherine, and Margaret speak to her with an impossible command: save France from English occupation. She is an illiterate peasant girl ‚Äî yet the voices are unmistakable and persistent.", "challenge": { "type": "dilemma", "prompt": "You hear a divine call to do something far beyond your abilities. What do you do?", "options": ["Trust the call and take the first step despite your fear", "Wait for a sign that you're truly worthy", "Tell no one and hope the voices stop", "Ask someone more qualified to go instead"], "answer_index": 0 }, "reward": {"Faith": 2, "Courage": 1} },
        { "title": "The Siege of Orl√©ans", "story": "Joan convinces the Dauphin to give her armor and an army. At 17, she rides into the besieged city of Orl√©ans, rallying demoralized French troops. In just nine days, she breaks the English siege ‚Äî a turning point in the Hundred Years' War that stunned all of Europe.", "challenge": { "type": "trivia", "question": "How long did it take Joan of Arc to lift the Siege of Orl√©ans?", "choices": ["Nine days", "Three months", "One year", "Three days"], "answer_index": 0 }, "reward": {"Courage": 2, "Faith": 1} },
        { "title": "The Coronation at Reims", "story": "After liberating Orl√©ans, Joan escorts the Dauphin Charles through enemy territory to the cathedral at Reims, where French kings are traditionally crowned. On July 17, 1429, Charles VII is crowned King of France ‚Äî fulfilling Joan's divine mission and legitimizing his claim to the throne.", "challenge": { "type": "trivia", "question": "In which cathedral was Charles VII crowned, fulfilling Joan's mission?", "choices": ["Reims Cathedral", "Notre-Dame de Paris", "Chartres Cathedral", "Sainte-Chapelle"], "answer_index": 0 }, "reward": {"Faith": 1, "Courage": 2} },
        { "title": "The Trial", "story": "Captured by Burgundian forces and sold to the English, Joan faces a rigged ecclesiastical trial in Rouen. Her judges, loyal to England, twist her words and accuse her of heresy and witchcraft. Despite months of interrogation, the uneducated teenager's answers are so brilliant that they confound the learned theologians.", "challenge": { "type": "dilemma", "prompt": "You face an unjust trial where the verdict is predetermined. How do you respond?", "options": ["Speak the truth boldly, trusting God with the outcome", "Recant everything to save your life", "Refuse to speak at all", "Try to negotiate a secret deal"], "answer_index": 0 }, "reward": {"Courage": 2, "Faith": 1} },
        { "title": "The Flames of Rouen", "story": "On May 30, 1431, nineteen-year-old Joan is burned at the stake in the marketplace of Rouen. She asks for a cross to be held before her eyes and calls out the name of Jesus with her final breaths. Twenty-five years later, a retrial declares her innocent. She is canonized in 1920.", "challenge": { "type": "trivia", "question": "What was Joan of Arc's age when she was martyred at Rouen?", "choices": ["19", "17", "21", "25"], "answer_index": 0 }, "reward": {"Courage": 2, "Faith": 2} }
      ],
      "aquinas": [
        { "title": "The Dumb Ox", "story": "Young Thomas is so large, quiet, and slow-moving that his classmates at the University of Paris mock him as 'the Dumb Ox.' His teacher, the great Albertus Magnus, sees something the others miss. After Thomas delivers a brilliant disputation, Albert declares: 'You call him the Dumb Ox, but I tell you this ox will bellow so loud his bellowing will fill the world.'", "challenge": { "type": "trivia", "question": "Who was Thomas Aquinas's famous teacher who defended him as 'the Dumb Ox'?", "choices": ["Albertus Magnus", "Peter Lombard", "Bonaventure", "Anselm of Canterbury"], "answer_index": 0 }, "reward": {"Wisdom": 2, "Faith": 1} },
        { "title": "The Summa Theologica", "story": "Thomas embarks on the most ambitious intellectual project in Christian history ‚Äî the Summa Theologica. In this masterwork, he systematically addresses nearly every question about God, creation, morality, and salvation. It contains 3,125 articles, each structured with objections, a core argument, and replies. He never finished it.", "challenge": { "type": "trivia", "question": "How many articles does the Summa Theologica contain?", "choices": ["About 3,125", "About 500", "About 10,000", "About 1,000"], "answer_index": 0 }, "reward": {"Wisdom": 2, "Faith": 1} },
        { "title": "The Five Ways", "story": "In the Summa, Thomas presents five rational arguments for the existence of God ‚Äî from motion, causation, contingency, degrees of perfection, and design. These 'Five Ways' become the foundation of natural theology, showing that faith and reason are not enemies but partners in the search for truth.", "challenge": { "type": "trivia", "question": "Which of these is NOT one of Aquinas's Five Ways to prove God's existence?", "choices": ["The argument from Scripture", "The argument from motion", "The argument from causation", "The argument from design"], "answer_index": 0 }, "reward": {"Wisdom": 2, "Courage": 1} },
        { "title": "Pange Lingua", "story": "Pope Urban IV asks Thomas to compose hymns for the new feast of Corpus Christi. Thomas writes 'Pange Lingua' and 'Tantum Ergo' ‚Äî Eucharistic hymns of such beauty and theological precision that they are still sung in every Catholic church nearly 800 years later.", "challenge": { "type": "dilemma", "prompt": "You're asked to create something to honor the Eucharist. What approach do you take?", "options": ["Pour your deepest understanding of the mystery into art", "Copy what others have done before", "Decline ‚Äî you're a thinker, not an artist", "Rush through it to move on to 'real' work"], "answer_index": 0 }, "reward": {"Faith": 2, "Wisdom": 1} },
        { "title": "Straw and Fire", "story": "On December 6, 1273, during Mass, Thomas has a mystical experience so profound that he stops writing forever. When urged to continue the Summa, he replies: 'Everything I have written seems like straw compared to what has now been revealed to me.' The greatest intellect of his age falls silent before the mystery of God.", "challenge": { "type": "dilemma", "prompt": "After a profound spiritual experience, you realize your life's work feels incomplete. What do you do?", "options": ["Accept that some mysteries are beyond words and rest in God", "Force yourself to keep writing ‚Äî the work must be finished", "Doubt the experience and return to normal", "Tell everyone about your vision to gain fame"], "answer_index": 0 }, "reward": {"Faith": 2, "Wisdom": 2} }
      ],
      "teresa": [
        { "title": "The Call Within a Call", "story": "Sister Teresa is already a nun teaching at a comfortable school in Calcutta when, on a train to Darjeeling in 1946, she receives what she calls 'a call within a call' ‚Äî a vision of Jesus asking her to leave the convent and serve the poorest of the poor in the slums. It means giving up everything she knows.", "challenge": { "type": "dilemma", "prompt": "You have a comfortable life serving God, but feel called to something harder. What do you do?", "options": ["Leave your comfort zone and follow the call", "Stay where you are ‚Äî you're already serving God", "Ask for more time to think about it", "Suggest someone else is better suited"], "answer_index": 0 }, "reward": {"Faith": 2, "Mercy": 1} },
        { "title": "The Missionaries of Charity", "story": "With no money, no building, and no helpers, Mother Teresa opens her first school in the slums of Motijhil, writing lessons in the dirt with a stick. Within a year, volunteers begin to join her. In 1950, the Vatican approves her new order ‚Äî the Missionaries of Charity ‚Äî which will grow to over 4,500 sisters serving in 133 countries.", "challenge": { "type": "trivia", "question": "In how many countries do the Missionaries of Charity now serve?", "choices": ["Over 130", "About 50", "About 25", "Over 200"], "answer_index": 0 }, "reward": {"Mercy": 2, "Faith": 1} },
        { "title": "Nirmal Hriday ‚Äî Home for the Dying", "story": "Mother Teresa opens Nirmal Hriday ('Pure Heart') in an abandoned Hindu temple ‚Äî a place where the destitute can die with dignity, surrounded by love. Critics attack her for not providing advanced medical care, but she insists: 'We are not social workers. We do this for Jesus.' She sees Christ in every suffering face.", "challenge": { "type": "dilemma", "prompt": "You can't save everyone. What matters most when helping the dying?", "options": ["Ensuring they feel loved and dignified in their final hours", "Providing the best possible medical equipment", "Documenting their stories for the world to see", "Focusing only on those you can actually cure"], "answer_index": 0 }, "reward": {"Mercy": 2, "Courage": 1} },
        { "title": "The Dark Night", "story": "After Mother Teresa's death in 1997, her private letters reveal a stunning secret: for nearly 50 years, she experienced almost complete spiritual darkness ‚Äî no sense of God's presence, no consolation in prayer. Yet she never wavered in her service. 'If I ever become a Saint,' she wrote, 'I will surely be one of darkness.'", "challenge": { "type": "trivia", "question": "For approximately how many years did Mother Teresa experience spiritual darkness?", "choices": ["Nearly 50 years", "About 10 years", "About 5 years", "Her entire life"], "answer_index": 0 }, "reward": {"Faith": 2, "Courage": 2} },
        { "title": "The Nobel Prize", "story": "In 1979, Mother Teresa receives the Nobel Peace Prize. She asks that the formal banquet be canceled and the money ‚Äî $192,000 ‚Äî be given to the poor of Calcutta. In her acceptance speech, she calls abortion 'the greatest destroyer of peace' ‚Äî a statement that shocks the secular audience but reflects her unwavering conviction.", "challenge": { "type": "trivia", "question": "What did Mother Teresa request be done with the Nobel Prize banquet funds?", "choices": ["Given to the poor of Calcutta", "Used to build a new hospital", "Donated to the Vatican", "Invested for future missions"], "answer_index": 0 }, "reward": {"Mercy": 2, "Faith": 1} }
      ],
      "patrick": [
        { "title": "Kidnapped to Ireland", "story": "At 16, the Roman-British boy Patricius is kidnapped by Irish raiders and sold into slavery. For six years he tends sheep on a cold Irish hillside, alone and far from home. In his isolation, he turns to prayer ‚Äî praying a hundred times a day and a hundred times each night ‚Äî and discovers a faith he never had as a free boy.", "challenge": { "type": "trivia", "question": "How many years was St. Patrick held as a slave in Ireland?", "choices": ["Six years", "Two years", "Ten years", "Twelve years"], "answer_index": 0 }, "reward": {"Courage": 2, "Faith": 1} },
        { "title": "The Great Escape", "story": "After six years of slavery, Patrick hears a voice in a dream telling him his ship is ready. He walks nearly 200 miles to the coast, convinces a crew of strangers to take him aboard, and eventually makes it back to Britain. Most people would never look back ‚Äî but Patrick can't forget the Irish people.", "challenge": { "type": "dilemma", "prompt": "You've escaped captivity and returned home safely. But you dream of the people who enslaved you calling for help. What do you do?", "options": ["Return to bring them the faith that saved you", "Stay safe at home ‚Äî you've suffered enough", "Send someone else in your place", "Try to forget the dreams"], "answer_index": 0 }, "reward": {"Courage": 2, "Mercy": 1} },
        { "title": "The Shamrock", "story": "Now a bishop, Patrick returns to Ireland to evangelize the pagan Celts. When the High King's druids challenge him to explain the Christian Trinity ‚Äî how God can be three persons yet one God ‚Äî Patrick bends down and picks a shamrock from the grass. 'Three leaves, one plant,' he says. The image becomes the most famous symbol of Ireland.", "challenge": { "type": "trivia", "question": "What doctrine did St. Patrick explain using the shamrock?", "choices": ["The Holy Trinity", "The Incarnation", "The Resurrection", "The Immaculate Conception"], "answer_index": 0 }, "reward": {"Wisdom": 1, "Faith": 2} },
        { "title": "Driving Out the Serpents", "story": "Legend holds that Patrick drove all the snakes from Ireland by standing on a hilltop and commanding them into the sea. While Ireland indeed has no native snakes, scholars believe the story symbolizes Patrick driving out pagan worship ‚Äî the 'serpents' of druidic religion that held the Irish people in spiritual bondage.", "challenge": { "type": "trivia", "question": "What do most scholars believe the 'snakes' St. Patrick drove from Ireland symbolize?", "choices": ["Pagan/druidic worship", "Actual reptiles", "Viking invaders", "Roman soldiers"], "answer_index": 0 }, "reward": {"Courage": 1, "Wisdom": 2} },
        { "title": "The Breastplate", "story": "Patrick composes the Lorica ‚Äî 'St. Patrick's Breastplate' ‚Äî a powerful prayer of protection invoking the Trinity, the forces of creation, and the armor of God. 'Christ with me, Christ before me, Christ behind me, Christ in me, Christ beneath me, Christ above me.' It has been prayed by Christians for over 1,500 years.", "challenge": { "type": "dilemma", "prompt": "You face spiritual danger. How do you protect yourself?", "options": ["Pray for Christ's protection in every direction", "Rely on your own strength and intelligence", "Avoid the situation entirely", "Ask others to pray while you stand aside"], "answer_index": 0 }, "reward": {"Faith": 2, "Courage": 1} }
      ],
      "therese": [
        { "title": "The Little Flower", "story": "Th√©r√®se Martin grows up in Lisieux, France, the youngest of five sisters ‚Äî four of whom become nuns. She is intensely sensitive, prone to tears, and seemingly unremarkable. Yet beneath her fragile exterior burns an enormous desire: to become a great saint. She will find a way no one expects.", "challenge": { "type": "dilemma", "prompt": "You feel a burning desire to do something great for God, but you seem ordinary. What do you do?", "options": ["Commit to doing small things with extraordinary love", "Wait until you develop extraordinary abilities", "Compare yourself to greater saints and feel inadequate", "Pursue dramatic, visible acts of holiness"], "answer_index": 0 }, "reward": {"Faith": 2, "Mercy": 1} },
        { "title": "Pleading with the Pope", "story": "At just 14, Th√©r√®se is desperate to enter the Carmelite convent but is told she's too young. On a family pilgrimage to Rome, she breaks protocol during a papal audience and falls at the feet of Pope Leo XIII, begging permission to enter Carmel at 15. The guards drag her away, but the Pope is impressed by her boldness.", "challenge": { "type": "trivia", "question": "At what age did Th√©r√®se enter the Carmelite convent?", "choices": ["15", "18", "12", "21"], "answer_index": 0 }, "reward": {"Courage": 2, "Faith": 1} },
        { "title": "The Little Way", "story": "Inside the convent, Th√©r√®se discovers her path to holiness: 'The Little Way.' She will not perform great penances or dramatic miracles. Instead, she will do every small task ‚Äî washing dishes, enduring a sister's annoying habits, smiling through pain ‚Äî with perfect love. 'Miss no single opportunity of making some small sacrifice,' she writes.", "challenge": { "type": "trivia", "question": "What is St. Th√©r√®se's spiritual path called?", "choices": ["The Little Way", "The Dark Night", "The Spiritual Exercises", "The Interior Castle"], "answer_index": 0 }, "reward": {"Faith": 1, "Mercy": 2} },
        { "title": "Story of a Soul", "story": "Under obedience to her superior, Th√©r√®se writes her autobiography ‚Äî 'Story of a Soul.' She describes her childhood, her vocation, and her Little Way with disarming honesty and poetic beauty. Published after her death, it becomes one of the most widely read spiritual books in history, inspiring millions.", "challenge": { "type": "trivia", "question": "What is the title of St. Th√©r√®se's autobiography?", "choices": ["Story of a Soul", "The Interior Castle", "Dark Night of the Soul", "Confessions"], "answer_index": 0 }, "reward": {"Wisdom": 1, "Faith": 2} },
        { "title": "A Shower of Roses", "story": "Dying of tuberculosis at 24, Th√©r√®se promises: 'After my death, I will let fall a shower of roses. I will spend my heaven doing good upon earth.' Within years of her death, reports of miracles and answered prayers flood in from around the world. She is declared a Doctor of the Church ‚Äî one of only four women to receive the title.", "challenge": { "type": "trivia", "question": "St. Th√©r√®se is one of how many women declared a Doctor of the Church?", "choices": ["Four", "Two", "Seven", "One"], "answer_index": 0 }, "reward": {"Faith": 2, "Mercy": 2} }
      ],
      "frassati": [
        { "title": "To the Heights!", "story": "Pier Giorgio Frassati is the son of the founder of the influential Italian newspaper La Stampa. Rich, handsome, and athletic, he could live a life of pure comfort. Instead, his motto is 'Verso l'alto!' ‚Äî 'To the heights!' ‚Äî referring not just to his beloved mountains but to the spiritual summit he pursues with reckless joy.", "challenge": { "type": "dilemma", "prompt": "You're born into wealth and privilege. What drives your life?", "options": ["Pursuing both physical and spiritual heights with joy", "Enjoying comfort ‚Äî you've earned it by birth", "Rejecting your family entirely to prove your virtue", "Using your status to gain political power"], "answer_index": 0 }, "reward": {"Courage": 2, "Faith": 1} },
        { "title": "The Secret Charity", "story": "Pier Giorgio gives away nearly everything ‚Äî his money, his clothes, even his bus fare (walking home in the rain so a poor family can eat). He keeps his charity so secret that his wealthy family has no idea. They think he's irresponsible with money. Only after his death do hundreds of poor families come forward to mourn the young man who helped them.", "challenge": { "type": "trivia", "question": "How did Pier Giorgio's family learn about his extensive charity work?", "choices": ["Poor families came forward after his death", "He told them on his deathbed", "A priest revealed it", "They found his journal"], "answer_index": 0 }, "reward": {"Mercy": 2, "Courage": 1} },
        { "title": "The Mountain Climber", "story": "Pier Giorgio is a passionate mountaineer, organizing trips with his friends to the Italian Alps. For him, climbing is both physical exhilaration and spiritual practice ‚Äî each summit brings him closer to God. His hiking group calls themselves 'I Tipi Loschi' ‚Äî 'The Shady Characters' ‚Äî and they combine adventure with deep friendship and faith.", "challenge": { "type": "dilemma", "prompt": "How do you combine friendship, adventure, and faith?", "options": ["Build a community around shared joy and spiritual growth", "Keep faith and fun strictly separate", "Only befriend people who share your beliefs", "Sacrifice all recreation for prayer and service"], "answer_index": 0 }, "reward": {"Courage": 1, "Faith": 1, "Mercy": 1} },
        { "title": "Standing Against Fascism", "story": "In 1920s Italy, Mussolini's Fascists are rising to power. Despite his father's connections to the political establishment, Pier Giorgio actively opposes Fascism, joining Catholic Action and speaking out for workers' rights. He is beaten by Blackshirts at a protest but refuses to back down ‚Äî combining his faith with fearless political courage.", "challenge": { "type": "trivia", "question": "What political movement did Pier Giorgio Frassati actively oppose?", "choices": ["Italian Fascism", "Communism", "Anarchism", "Monarchism"], "answer_index": 0 }, "reward": {"Courage": 2, "Wisdom": 1} },
        { "title": "A Death That Shook Turin", "story": "At just 24, Pier Giorgio contracts polio ‚Äî likely from the sick he served in Turin's poorest neighborhoods. He dies on July 4, 1925. His aristocratic family expects a small funeral. Instead, thousands of poor people flood the streets of Turin, weeping for the young man who gave them everything. His family is stunned ‚Äî they had no idea.", "challenge": { "type": "trivia", "question": "What disease took Pier Giorgio Frassati's life at age 24?", "choices": ["Polio", "Tuberculosis", "Influenza", "Typhoid"], "answer_index": 0 }, "reward": {"Mercy": 2, "Faith": 1} }
      ]
    };

    // Game State
    let currentSaint = null;
    let currentCheckpoint = 0;
    let virtues = {"Faith": 0, "Mercy": 0, "Courage": 0, "Wisdom": 0};
    let gameScreen = "select";
    let difficulty = "easy";
    let timerInterval = null;
    let timeLeft = 15;

    function setDifficulty(d, btn) {
      difficulty = d;
      document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      playSound('click');
    }

    function startTimer() {
      if (difficulty !== 'hard') return;
      const timerBar = document.getElementById('timer-bar');
      const timerFill = document.getElementById('timer-fill');
      timerBar.style.display = 'block';
      timeLeft = 15;
      timerFill.style.width = '100%';
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft -= 0.1;
        timerFill.style.width = Math.max(0, (timeLeft / 15) * 100) + '%';
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          autoSubmitWrong();
        }
      }, 100);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      document.getElementById('timer-bar').style.display = 'none';
    }

    function autoSubmitWrong() {
      if (isAnswerSubmitted) return;
      isAnswerSubmitted = true;
      stopTimer();
      playSound('wrong');
      shakeScreen();
      const resultEl = document.createElement('div');
      resultEl.className = 'result incorrect';
      resultEl.textContent = "‚è∞ Time's up!";
      questionContainer.appendChild(resultEl);
      setTimeout(() => {
        currentCheckpoint++;
        if (currentCheckpoint >= quests[currentSaint].length) { endGame(); } else { loadQuest(); }
        isAnswerSubmitted = false;
      }, 2000);
    }

    function showHint(q) {
      if (difficulty !== 'easy') return;
      const hintEl = document.getElementById('hint-text');
      const ch = q.challenge;
      if (ch.type === 'trivia') {
        const correct = ch.choices[ch.answer_index];
        hintEl.textContent = 'üí° Hint: The answer starts with "' + correct.charAt(0) + '"';
      } else {
        hintEl.textContent = 'üí° Hint: Think about what this saint would actually do.';
      }
      hintEl.style.display = 'block';
    }

    function spawnParticles(emoji) {
      for (let i = 0; i < 12; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.textContent = emoji;
        p.style.left = (Math.random() * 60 + 20) + 'vw';
        p.style.top = (Math.random() * 40 + 30) + 'vh';
        p.style.fontSize = (Math.random() * 16 + 12) + 'px';
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 1000);
      }
    }

    function shakeScreen() {
      const container = document.querySelector('.container');
      container.classList.add('shake');
      setTimeout(() => container.classList.remove('shake'), 400);
    }

    // Sound effects
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'click') {
        oscillator.type = 'sine';
        oscillator.frequency.value = 440;
        gainNode.gain.value = 0.3;
      } else if (type === 'correct') {
        oscillator.type = 'sine';
        oscillator.frequency.value = 880;
        gainNode.gain.value = 0.4;
      } else if (type === 'wrong') {
        oscillator.type = 'sine';
        oscillator.frequency.value = 220;
        gainNode.gain.value = 0.3;
      }
      
      oscillator.start();
      oscillator.stop(audioContext.currentTime + 0.2);

      if (type === 'fanfare') {
        // Play a triumphant chord
        [523, 659, 784].forEach((freq, i) => {
          const osc = audioContext.createOscillator();
          const gn = audioContext.createGain();
          osc.connect(gn); gn.connect(audioContext.destination);
          osc.type = 'sine'; osc.frequency.value = freq;
          gn.gain.value = 0.25;
          osc.start(audioContext.currentTime + i * 0.15);
          osc.stop(audioContext.currentTime + i * 0.15 + 0.4);
        });
      }
    }

    // DOM Elements
    const selectScreen = document.getElementById('select-screen');
    const playScreen = document.getElementById('play-screen');
    const doneScreen = document.getElementById('done-screen');
    const questTitle = document.getElementById('quest-title');
    const questStory = document.getElementById('quest-story');
    const questionContainer = document.getElementById('question-container');
    const profileContent = document.getElementById('profile-content');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const continueBtn = document.getElementById('continue-btn');
    const finalProfile = document.getElementById('final-profile');
    const saintName = document.getElementById('saint-name');
    const balloonsEl = document.getElementById('balloons');

    function selectSaint(saintId) {
      playSound('click');
      currentSaint = saintId;
      currentCheckpoint = 0;
      virtues = {"Faith": 0, "Mercy": 0, "Courage": 0, "Wisdom": 0};
      gameScreen = "play";
      updateScreen();
      updateProfile();
      loadQuest();
    }

    function resetGame() {
      playSound('click');
      currentSaint = null;
      currentCheckpoint = 0;
      virtues = {"Faith": 0, "Mercy": 0, "Courage": 0, "Wisdom": 0};
      gameScreen = "select";
      updateScreen();
      localStorage.removeItem('saintQuestScores');
    }

    function loadQuest() {
      const questList = quests[currentSaint];
      if (!questList || currentCheckpoint >= questList.length) {
        endGame();
        return;
      }

      const q = questList[currentCheckpoint];

      questTitle.textContent = q.title;
      questStory.textContent = q.story;

      // Generate question elements
      questionContainer.innerHTML = '';

      if (q.challenge.type === 'trivia') {
        questionContainer.innerHTML = `
          <h3>üìú Knowledge Check</h3>
          <p>${q.challenge.question}</p>
          <div class="radio-group">
            ${q.challenge.choices.map((choice, index) => `
              <label class="radio-option">
                <input type="radio" name="answer" value="${index}" onclick="submitAnswer(${index}, true)"> ${choice}
              </label>
            `).join('')}
          </div>
          <button class="btn" onclick="submitAnswer(-1, true)">Submit Answer</button>
        `;
      } else if (q.challenge.type === 'dilemma') {
        questionContainer.innerHTML = `
          <h3>‚öñÔ∏è What will you do?</h3>
          <p>${q.challenge.prompt}</p>
          <div class="radio-group">
            ${q.challenge.options.map((option, index) => `
              <label class="radio-option">
                <input type="radio" name="answer" value="${index}" onclick="submitAnswer(${index}, false)"> ${option}
              </label>
            `).join('')}
          </div>
          <button class="btn" onclick="submitAnswer(-1, false)">Make Choice</button>
        `;
      }

      // Difficulty features
      document.getElementById('hint-text').style.display = 'none';
      showHint(q);
      startTimer();
    }

    let isAnswerSubmitted = false;

    function submitAnswer(selectedIndex, isTrivia) {
      if (isAnswerSubmitted) return;
      isAnswerSubmitted = true;

      const questList = quests[currentSaint];
      const q = questList[currentCheckpoint];
      const answer = q.challenge.answer_index;

      if (selectedIndex === -1) {
        alert('Please select an option.');
        isAnswerSubmitted = false;
        return;
      }

      const isCorrect = selectedIndex === answer;

      stopTimer();
      if (isCorrect) {
        playSound('correct');
        spawnParticles('‚ú®');
        const resultEl = document.createElement('div');
        resultEl.className = 'result correct';
        resultEl.textContent = 'Correct! +Virtue';
        questionContainer.appendChild(resultEl);
        for (const [key, value] of Object.entries(q.reward)) {
          virtues[key] += value;
        }
      } else {
        playSound('wrong');
        shakeScreen();
        const resultEl = document.createElement('div');
        resultEl.className = 'result incorrect';
        const ch = q.challenge;
        const correctAnswer = ch.type === 'trivia' ? ch.choices[ch.answer_index] : ch.options[ch.answer_index];
        if (difficulty === 'easy') {
          resultEl.textContent = 'Not quite ‚Äî the answer was: ' + correctAnswer;
        } else {
          resultEl.textContent = 'Not quite ‚Äî try next challenge.';
        }
        questionContainer.appendChild(resultEl);
      }

      // Update profile immediately
      updateProfile();

      // Continue after delay
      setTimeout(() => {
        currentCheckpoint++;
        if (currentCheckpoint >= questList.length) {
          endGame();
        } else {
          loadQuest();
        }
        isAnswerSubmitted = false;
      }, 2000);
    }

    function drawRadarChart() {
      const canvas = document.getElementById('radar-canvas');
      const ctx = canvas.getContext('2d');
      const cx = 150, cy = 150, r = 110;
      const labels = ['Faith', 'Mercy', 'Courage', 'Wisdom'];
      const maxVal = Math.max(...Object.values(virtues), 10);
      const values = labels.map(l => (virtues[l] || 0) / maxVal);
      const n = labels.length;

      ctx.clearRect(0, 0, 300, 300);

      // Draw grid rings
      for (let ring = 0.25; ring <= 1; ring += 0.25) {
        ctx.beginPath();
        for (let i = 0; i <= n; i++) {
          const angle = (Math.PI * 2 * (i % n)) / n - Math.PI / 2;
          const x = cx + r * ring * Math.cos(angle);
          const y = cy + r * ring * Math.sin(angle);
          i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        }
        ctx.strokeStyle = 'rgba(255,255,255,0.1)';
        ctx.stroke();
      }

      // Draw axes
      for (let i = 0; i < n; i++) {
        const angle = (Math.PI * 2 * i) / n - Math.PI / 2;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(cx + r * Math.cos(angle), cy + r * Math.sin(angle));
        ctx.strokeStyle = 'rgba(255,255,255,0.15)';
        ctx.stroke();
      }

      // Draw "perfect" outline
      ctx.beginPath();
      for (let i = 0; i <= n; i++) {
        const angle = (Math.PI * 2 * (i % n)) / n - Math.PI / 2;
        const x = cx + r * Math.cos(angle);
        const y = cy + r * Math.sin(angle);
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }
      ctx.strokeStyle = 'rgba(212,175,55,0.3)';
      ctx.lineWidth = 2;
      ctx.setLineDash([5, 5]);
      ctx.stroke();
      ctx.setLineDash([]);

      // Draw player values
      ctx.beginPath();
      for (let i = 0; i <= n; i++) {
        const angle = (Math.PI * 2 * (i % n)) / n - Math.PI / 2;
        const v = values[i % n];
        const x = cx + r * v * Math.cos(angle);
        const y = cy + r * v * Math.sin(angle);
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }
      ctx.fillStyle = 'rgba(99,102,241,0.3)';
      ctx.fill();
      ctx.strokeStyle = '#6366f1';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Draw dots and labels
      const colors = { Faith: '#2196F3', Mercy: '#4CAF50', Courage: '#F44336', Wisdom: '#9C27B0' };
      for (let i = 0; i < n; i++) {
        const angle = (Math.PI * 2 * i) / n - Math.PI / 2;
        const v = values[i];
        const x = cx + r * v * Math.cos(angle);
        const y = cy + r * v * Math.sin(angle);
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, Math.PI * 2);
        ctx.fillStyle = colors[labels[i]];
        ctx.fill();

        // Labels
        const lx = cx + (r + 20) * Math.cos(angle);
        const ly = cy + (r + 20) * Math.sin(angle);
        ctx.fillStyle = colors[labels[i]];
        ctx.font = 'bold 13px Lato, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(labels[i] + ' ' + (virtues[labels[i]] || 0), lx, ly);
      }
    }

    function endGame() {
      gameScreen = "done";
      stopTimer();
      updateScreen();
      saintName.textContent = saints.find(s => s.id === currentSaint).name;

      // Draw radar chart
      drawRadarChart();

      // Display final virtues
      let profileHTML = '';
      for (const [key, value] of Object.entries(virtues)) {
        if (value > 0) {
          const className = `v-${key.toLowerCase()}`;
          profileHTML += `<span class="virtue-badge ${className}">${key}: ${value}</span> `;
        }
      }
      finalProfile.innerHTML = profileHTML;

      // Save high score
      saveHighScore();

      // Celebration!
      playSound('fanfare');
      spawnParticles('üèÜ');
      showBalloons();
    }

    function updateProfile() {
      let profileHTML = `<div style="text-align: center;"><div style="font-size: 50px;">${saints.find(s => s.id === currentSaint).avatar}</div>
        <b>${saints.find(s => s.id === currentSaint).name}</b><hr style="margin: 15px 0;">`;

      for (const [key, value] of Object.entries(virtues)) {
        if (value > 0) {
          const className = `v-${key.toLowerCase()}`;
          profileHTML += `<span class="virtue-badge ${className}">${key}: ${value}</span>`;
        }
      }

      profileHTML += `</div>`;
      profileContent.innerHTML = profileHTML;
    }

    function updateScreen() {
      // Hide all screens
      selectScreen.classList.remove('active');
      playScreen.classList.remove('active');
      doneScreen.classList.remove('active');

      if (gameScreen === "select") {
        selectScreen.classList.add('active');
      } else if (gameScreen === "play") {
        playScreen.classList.add('active');
        const questList = quests[currentSaint];
        const progress = (currentCheckpoint / questList.length) * 100;
        progressBar.style.width = progress + '%';
        progressText.textContent = `Chapter ${currentCheckpoint + 1} of ${questList.length}`;
      } else if (gameScreen === "done") {
        doneScreen.classList.add('active');
      }
    }

    function showBalloons() {
      balloonsEl.style.opacity = '1';

      for (let i = 0; i < 30; i++) {
        const balloon = document.createElement('div');
        balloon.className = 'balloon';
        balloon.textContent = 'üéà';
        balloon.style.left = Math.random() * 100 + 'vw';
        balloon.style.animationDuration = (Math.random() * 10 + 5) + 's';
        balloon.style.animationDelay = Math.random() * 5 + 's';
        balloonsEl.appendChild(balloon);
      }
    }

    function saveHighScore() {
      const scores = JSON.parse(localStorage.getItem('saintQuestScores') || '{}');

      const score = Object.values(virtues).reduce((acc, val) => acc + val, 0);
      scores[currentSaint] = scores[currentSaint] || 0;

      if (score > scores[currentSaint]) {
        scores[currentSaint] = score;
        localStorage.setItem('saintQuestScores', JSON.stringify(scores));
      }
    }

    // Build saint selection grid dynamically
    const saintGrid = document.getElementById('saint-grid');
    saints.forEach(s => {
      const card = document.createElement('div');
      card.className = 'saint-card';
      card.onclick = () => selectSaint(s.id);
      card.innerHTML = `
        <div class="avatar">${s.avatar}</div>
        <h3>${s.name}</h3>
        <p><i>Virtues: ${s.virtues.join(', ')}</i></p>
      `;
      saintGrid.appendChild(card);
    });

    // Initial screen update
    updateScreen();

    // Load high scores from localStorage
    const savedScores = JSON.parse(localStorage.getItem('saintQuestScores') || '{}');
  </script>
</body>
</html>